# Aurora Web - Web Interface

Aurora Web æ˜¯ Aurora é‡åŒ–äº¤æ˜“æ¡†æ¶çš„ Web ç•Œé¢,æä¾›å›¾å½¢åŒ–çš„é…ç½®ç®¡ç†ã€å›æµ‹æ‰§è¡Œå’Œç»“æœå¯è§†åŒ–åŠŸèƒ½ã€‚

## æŠ€æœ¯æ ˆ

- **Web æ¡†æ¶**: [Axum](https://github.com/tokio-rs/axum) 0.8.6 - é«˜æ€§èƒ½å¼‚æ­¥ Web æ¡†æ¶
- **ä¸­é—´ä»¶**: Tower 0.5 å’Œ Tower-HTTP 0.6 - æ¨¡å—åŒ–ä¸­é—´ä»¶ç³»ç»Ÿ
- **WebSocket**: Axum å†…ç½® WebSocket æ”¯æŒ (åŸºäº futures-util)
- **å¼‚æ­¥è¿è¡Œæ—¶**: Tokio 1.41
- **åºåˆ—åŒ–**: Serde + JSON/TOML

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“ **é…ç½®ç®¡ç†**: é€šè¿‡ RESTful API åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤å›æµ‹é…ç½®æ–‡ä»¶
- ğŸš€ **å›æµ‹æ‰§è¡Œ**: åˆ›å»ºå’Œç®¡ç†å›æµ‹ä»»åŠ¡,æ”¯æŒä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†
- ğŸ“Š **ç»“æœå¯è§†åŒ–**: æä¾›é™æ€èµ„æºæœåŠ¡,å±•ç¤ºå›æµ‹ç»“æœ
- ğŸ“ **æ•°æ®ç®¡ç†**: ç®¡ç†å†å²æ•°æ®æ–‡ä»¶,æŸ¥çœ‹æ•°æ®é›†ä¿¡æ¯å’Œè®°å½•æ•°
- ğŸ”„ **WebSocket æ”¯æŒ**: å®æ—¶æ¨é€å›æµ‹è¿›åº¦å’Œæ‰§è¡ŒçŠ¶æ€
- âœ… **å®Œæ•´æµ‹è¯•**: åŒ…å«é›†æˆæµ‹è¯•,ç¡®ä¿ API åŠŸèƒ½æ­£å¸¸

## å¿«é€Ÿå¼€å§‹

### å¯åŠ¨æœåŠ¡å™¨

```bash
# ä»é¡¹ç›®æ ¹ç›®å½•
cargo run -p aurora-web

# æˆ–è€…ä» aurora-web ç›®å½•
cd aurora-web
cargo run
```

æœåŠ¡å™¨é»˜è®¤è¿è¡Œåœ¨ `http://127.0.0.1:8080`

è®¿é—® `http://127.0.0.1:8080` å¯ä»¥çœ‹åˆ°é™æ€ Web ç•Œé¢ã€‚

### API ç«¯ç‚¹

#### é…ç½®ç®¡ç† (`/api/config`)

- `GET /api/config` - åˆ—å‡ºæ‰€æœ‰é…ç½®æ–‡ä»¶
- `POST /api/config` - åˆ›å»ºæ–°é…ç½®æ–‡ä»¶
- `GET /api/config/{filename}` - è·å–æŒ‡å®šé…ç½®æ–‡ä»¶å†…å®¹
- `PUT /api/config/{filename}` - æ›´æ–°æŒ‡å®šé…ç½®æ–‡ä»¶
- `DELETE /api/config/{filename}` - åˆ é™¤æŒ‡å®šé…ç½®æ–‡ä»¶
- `POST /api/config/validate` - éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼

**è¯·æ±‚ç¤ºä¾‹**:
```bash
# åˆ›å»ºé…ç½®
curl -X POST http://127.0.0.1:8080/api/config \
  -H "Content-Type: application/json" \
  -d '{"filename":"test.toml","content":"[portfolio]\ninitial_cash = 10000.0\n"}'

# åˆ—å‡ºé…ç½®
curl http://127.0.0.1:8080/api/config
```

#### å›æµ‹ç®¡ç† (`/api/backtest`)

- `GET /api/backtest` - åˆ—å‡ºæ‰€æœ‰å›æµ‹ä»»åŠ¡
- `POST /api/backtest` - åˆ›å»ºæ–°å›æµ‹ä»»åŠ¡
- `GET /api/backtest/{id}` - è·å–æŒ‡å®šå›æµ‹ä»»åŠ¡è¯¦æƒ…
- `DELETE /api/backtest/{id}` - åˆ é™¤æŒ‡å®šå›æµ‹ä»»åŠ¡
- `POST /api/backtest/{id}/start` - å¯åŠ¨æŒ‡å®šå›æµ‹ä»»åŠ¡

**è¯·æ±‚ç¤ºä¾‹**:
```bash
# åˆ›å»ºå›æµ‹ä»»åŠ¡
curl -X POST http://127.0.0.1:8080/api/backtest \
  -H "Content-Type: application/json" \
  -d '{"name":"æµ‹è¯•å›æµ‹","config_path":"./configs/test.toml","data_path":"./data/btc_1h.csv"}'

# å¯åŠ¨å›æµ‹ä»»åŠ¡
curl -X POST http://127.0.0.1:8080/api/backtest/{task_id}/start
```

#### æ•°æ®ç®¡ç† (`/api/data`)

- `GET /api/data/list` - åˆ—å‡ºæ‰€æœ‰æ•°æ®æ–‡ä»¶(åŒ…å«æ–‡ä»¶å¤§å°å’Œè®°å½•æ•°)
- `GET /api/data/{filename}` - è·å–æŒ‡å®šæ•°æ®æ–‡ä»¶ä¿¡æ¯
- `DELETE /api/data/{filename}` - åˆ é™¤æŒ‡å®šæ•°æ®æ–‡ä»¶

**è¯·æ±‚ç¤ºä¾‹**:
```bash
# åˆ—å‡ºæ•°æ®æ–‡ä»¶
curl http://127.0.0.1:8080/api/data/list
```

#### WebSocket (`/ws`)

- `WS /ws/backtest/{id}` - è®¢é˜…å›æµ‹ä»»åŠ¡çš„å®æ—¶è¿›åº¦æ›´æ–°

**è¿æ¥ç¤ºä¾‹**:
```javascript
const ws = new WebSocket('ws://127.0.0.1:8080/ws/backtest/' + taskId);
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  console.log('è¿›åº¦æ›´æ–°:', data);
};
```

> **æ³¨æ„**: Axum 0.8 ä½¿ç”¨ `{param}` è¯­æ³•è¡¨ç¤ºè·¯å¾„å‚æ•°ï¼Œè€Œä¸æ˜¯ 0.7 ç‰ˆæœ¬çš„ `:param` è¯­æ³•ã€‚

#### é™æ€æ–‡ä»¶æœåŠ¡

- `/` - é™æ€ Web ç•Œé¢ï¼Œè‡ªåŠ¨æä¾› `index.html`
- `/css/*`, `/js/*` - é™æ€èµ„æºæ–‡ä»¶

## é¡¹ç›®ç»“æ„

```
aurora-web/
â”œâ”€â”€ Cargo.toml               # é¡¹ç›®é…ç½®å’Œä¾èµ–
â”œâ”€â”€ README.md                # æœ¬æ–‡æ¡£
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs              # ä¸»å…¥å£ - Axum æœåŠ¡å™¨å¯åŠ¨
â”‚   â”œâ”€â”€ lib.rs               # åº“å…¥å£ - æ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ error.rs             # é”™è¯¯ç±»å‹å®šä¹‰ (å®ç° IntoResponse)
â”‚   â”œâ”€â”€ api/                 # RESTful API è·¯ç”±å’Œå¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ mod.rs           # API æ¨¡å—å…¥å£
â”‚   â”‚   â”œâ”€â”€ config.rs        # é…ç½®ç®¡ç† API (CRUD + éªŒè¯)
â”‚   â”‚   â”œâ”€â”€ backtest.rs      # å›æµ‹ä»»åŠ¡ç®¡ç† API (CRUD + å¯åŠ¨)
â”‚   â”‚   â””â”€â”€ data.rs          # æ•°æ®æ–‡ä»¶ç®¡ç† API (åˆ—è¡¨ + æŸ¥è¯¢ + åˆ é™¤)
â”‚   â”œâ”€â”€ state/               # åº”ç”¨çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ mod.rs           # çŠ¶æ€æ¨¡å— (AppState - Clone)
â”‚   â”‚   â””â”€â”€ backtest.rs      # å›æµ‹ä»»åŠ¡çŠ¶æ€ (BacktestTask, BacktestStatus)
â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ mod.rs           # æ¨¡å‹æ¨¡å—å…¥å£
â”‚   â”‚   â”œâ”€â”€ request.rs       # è¯·æ±‚æ•°æ®ç»“æ„
â”‚   â”‚   â””â”€â”€ response.rs      # å“åº”æ•°æ®ç»“æ„
â”‚   â””â”€â”€ ws/                  # WebSocket å¤„ç†
â”‚       â”œâ”€â”€ mod.rs           # WebSocket è·¯ç”±é…ç½®
â”‚       â””â”€â”€ backtest.rs      # å›æµ‹è¿›åº¦å®æ—¶æ¨é€
â”œâ”€â”€ static/                  # é™æ€ Web èµ„æº
â”‚   â”œâ”€â”€ index.html           # å‰ç«¯ä¸»é¡µé¢
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css        # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ js/
â”‚       â”œâ”€â”€ app.js           # ä¸»åº”ç”¨é€»è¾‘
â”‚       â”œâ”€â”€ config.js        # é…ç½®ç®¡ç†å‰ç«¯
â”‚       â”œâ”€â”€ backtest.js      # å›æµ‹æ‰§è¡Œå‰ç«¯
â”‚       â”œâ”€â”€ charts.js        # å›¾è¡¨å¯è§†åŒ–
â”‚       â””â”€â”€ data.js          # æ•°æ®ç®¡ç†å‰ç«¯
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ integration_tests.rs # é›†æˆæµ‹è¯• (åŸºäº Axum æµ‹è¯•æ¡†æ¶)
â”œâ”€â”€ test_configs/            # æµ‹è¯•é…ç½®æ–‡ä»¶
â””â”€â”€ test_data/               # æµ‹è¯•æ•°æ®æ–‡ä»¶
```

## å¼€å‘è¯´æ˜

### æ„å»ºå’Œè¿è¡Œ

```bash
# æ£€æŸ¥ç¼–è¯‘
cargo check

# æ„å»ºé¡¹ç›®
cargo build

# è¿è¡Œå¼€å‘æœåŠ¡å™¨
cargo run

# æ„å»ºå‘å¸ƒç‰ˆæœ¬
cargo build --release
```

### æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œé›†æˆæµ‹è¯•
cargo test --test integration_tests

# è¿è¡Œç‰¹å®šæµ‹è¯•
cargo test test_list_configs

# æ˜¾ç¤ºæµ‹è¯•è¾“å‡º
cargo test -- --nocapture
```

**é›†æˆæµ‹è¯•è¦†ç›–**:
- âœ… é…ç½®æ–‡ä»¶åˆ—è¡¨å’Œåˆ›å»º
- âœ… é…ç½®æ–‡ä»¶éªŒè¯
- âœ… æ•°æ®æ–‡ä»¶åˆ—è¡¨
- âœ… å›æµ‹ä»»åŠ¡ CRUD æ“ä½œ
- âœ… é”™è¯¯å¤„ç† (å¦‚ä¸å­˜åœ¨çš„é…ç½®)

### ä»£ç è´¨é‡

é¡¹ç›®éµå¾ªä»¥ä¸‹çº¦å®šï¼š

- âœ… **è®¸å¯è¯**: æ‰€æœ‰æºä»£ç æ–‡ä»¶åŒ…å« Apache 2.0 è®¸å¯è¯å¤´éƒ¨
- âœ… **æ–‡ä»¶å¤§å°**: å•ä¸ªæ–‡ä»¶ä¸è¶…è¿‡ 500 è¡Œ
- âœ… **æ¨¡å—åŒ–**: é«˜å†…èšã€ä½è€¦åˆçš„ç»„ä»¶è®¾è®¡
- âœ… **æ³¨é‡Š**: è¯¦ç»†çš„å†…éƒ¨æ³¨é‡Š (`//`) å’Œæ–‡æ¡£æ³¨é‡Š (`///`)
- âœ… **æµ‹è¯•**: å®Œæ•´çš„é›†æˆæµ‹è¯•è¦†ç›–
- âœ… **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯ç±»å‹å’Œå“åº”æ ¼å¼

### æŠ€æœ¯ç»†èŠ‚

#### çŠ¶æ€ç®¡ç†

`AppState` æ˜¯åº”ç”¨çš„å…±äº«çŠ¶æ€ï¼ŒåŒ…å«ï¼š
- `backtest_tasks`: å›æµ‹ä»»åŠ¡æ˜ å°„è¡¨ (çº¿ç¨‹å®‰å…¨çš„ RwLock)
- `data_dir`: æ•°æ®æ–‡ä»¶ç›®å½•è·¯å¾„
- `config_dir`: é…ç½®æ–‡ä»¶ç›®å½•è·¯å¾„

#### é”™è¯¯å¤„ç†

`WebError` å®ç°äº† `IntoResponse` traitï¼Œè‡ªåŠ¨å°†é”™è¯¯è½¬æ¢ä¸ºåˆé€‚çš„ HTTP å“åº”ï¼š
- `ConfigError` â†’ 400 Bad Request
- `TaskNotFound`, `DataNotFound` â†’ 404 Not Found
- `IoError`, `BacktestError` â†’ 500 Internal Server Error

#### ä¸­é—´ä»¶

- **TraceLayer**: è¯·æ±‚æ—¥å¿—è®°å½•
- **CorsLayer**: CORS æ”¯æŒ (å…è®¸æ‰€æœ‰æ¥æº)
- **ServeDir**: é™æ€æ–‡ä»¶æœåŠ¡

### æ¶æ„è¯´æ˜

æœ¬é¡¹ç›®é‡‡ç”¨ **Axum** æ¡†æ¶æ„å»ºï¼Œç›¸æ¯”ä¹‹å‰çš„ Actix-Webï¼š

- æ›´å¥½çš„ç±»å‹å®‰å…¨å’Œç¼–è¯‘æ—¶æ£€æŸ¥
- åŸºäº Tower çš„æ¨¡å—åŒ–ä¸­é—´ä»¶ç³»ç»Ÿ
- æ›´ç®€æ´çš„æå–å™¨ (Extractors) æ¨¡å¼
- åŸç”Ÿ WebSocket æ”¯æŒï¼Œæ— éœ€é¢å¤–ä¾èµ–

è¯¦è§ [`docs/MIGRATION_SUMMARY.md`](docs/MIGRATION_SUMMARY.md) äº†è§£è¿ç§»è¯¦æƒ…ã€‚

## License

Copyright 2025 blingbling21

Licensed under the Apache License, Version 2.0.
