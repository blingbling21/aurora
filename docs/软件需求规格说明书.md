
---

### **软件需求规格说明书 (SRS) - 项目代号：Aurora**

**版本：** 1.0
**日期：** 2025年9月29日

#### **1. 项目概述**

本项目旨在开发一个模块化的、事件驱动的量化交易研究框架“Aurora”。该框架使用Rust语言编写，旨在提供高性能、高安全性的工具，支持从数据采集、策略回测到实时模拟交易的全流程。

**核心目标：**
*   **模块化：** 各功能组件（数据、策略、执行等）应高度解耦，易于独立开发、测试和替换。
*   **性能：** 核心数据处理和回测引擎应具备高吞吐量和低延迟的特性。
*   **安全性：** 利用Rust的特性，在编译期杜绝内存安全和并发数据竞争问题。
*   **可扩展性：** 框架应易于扩展，支持新的数据源、技术指标和交易策略。

---

### **阶段零：地基与工具箱 (Foundation & Tooling)**

**目标：** 搭建统一、稳固的开发环境和项目结构。

| 需求ID | 需求描述 | 验收标准 |
| :--- | :--- | :--- |
| FND-001 | **项目结构** | 项目应使用Cargo Workspace进行管理，包含`aurora-core`, `aurora-data`, `aurora-indicators`, `aurora-strategy`, `aurora-backtester`, `aurora-live`六个初始成员包。 |
| FND-002 | **开发环境** | 所有开发者应使用统一的Rust稳定版本（例如：最新的1.xx版本），并推荐使用`rust-analyzer`进行IDE支持。 |
| FND-003 | **版本控制** | 项目应使用Git进行版本控制，并托管在代码仓库（如GitHub）。应建立`main`和`develop`分支。 |
| FND-004 | **日志系统** | 项目应引入`tracing`和`tracing-subscriber`作为统一的日志框架，替代所有`println!`调用，并支持日志级别控制（INFO, DEBUG, ERROR）。 |
| FND-005 | **命令行接口** | 对于可执行包（`aurora-data`, `aurora-backtester`, `aurora-live`），应使用`clap`库构建结构化的命令行接口。 |

---

### **阶段一：数据核心 (Data Core)**

**目标：** 定义统一的数据模型并实现可靠的数据采集功能。

| 需求ID | 需求类型 | 需求描述 | 验收标准 |
| :--- | :--- | :--- | :--- |
| **`aurora-core` (核心库)** |
| CORE-001 | 功能 | **K-Line数据结构** | 应定义一个`Kline`结构体，包含`timestamp` (u64, Unix毫秒), `open`, `high`, `low`, `close`, `volume` (均为f64)。 |
| CORE-002 | 功能 | **数据序列化** | `Kline`结构体必须派生`serde::Deserialize`和`serde::Serialize`，以支持JSON和CSV的（反）序列化。同时应派生`Debug`, `Clone`, `PartialEq`。 |
| CORE-003 | 功能 | **Signal枚举** | 应定义一个`Signal`枚举，包含`Buy`, `Sell`, `Hold`三个变体，用于策略输出。 |
| **`aurora-data` (数据采集器)** |
| DATA-001 | 功能 | **历史数据下载器CLI** | `aurora-data`应提供`download`子命令，支持`--symbol`, `--interval`, `--start-time`, `--end-time`等参数，用于指定下载的数据范围。 |
| DATA-002 | 功能 | **REST API接口** | 下载器应能通过`reqwest`向指定的加密货币交易所（初始目标：Binance）的公开REST API发送请求，获取历史K线数据。 |
| DATA-003 | 功能 | **数据存储** | 下载的数据应能被正确解析为`Kline`对象列表，并使用`csv`库以CSV格式存储到本地，文件名应包含交易对、间隔等信息。 |
| DATA-004 | 功能 | **实时数据接收器CLI** | `aurora-data`应提供`stream`子命令，支持`--symbol`, `--stream-type` (如`kline`, `trade`)等参数。 |
| DATA-005 | 功能 | **WebSocket连接** | 接收器应能使用`tokio-tungstenite`连接到交易所的WebSocket API，并订阅指定的实时数据频道。 |
| DATA-006 | 非功能 | **连接稳定性** | WebSocket连接应具备自动重连机制。在断开连接后，程序应能以指数退避策略尝试重新连接。 |
| DATA-007 | 功能 | **实时数据输出** | 接收到的实时数据流应被正确解析为相应的核心结构体，并以结构化的日志格式打印到标准输出。 |

---

### **阶段二：策略大脑 (Strategy Brain)**

**目标：** 建立可插拔的策略开发框架。

| 需求ID | 需求类型 | 需求描述 | 验收标准 |
| :--- | :--- | :--- | :--- |
| **`aurora-indicators` (指标库)** |
| IND-001 | 功能 | **移动平均线(MA)实现** | 应提供一个`MA`结构体，包含`new(period: usize)`构造函数和`update(price: f64) -> Option<f64>`方法。在数据点不足时返回`None`。 |
| IND-002 | 功能 | **指标可测试性** | 所有指标实现都必须附带单元测试，覆盖边界条件（如数据不足、价格不变等）。 |
| **`aurora-strategy` (策略库)** |
| STR-001 | 接口 | **Strategy Trait** | 应定义一个`Strategy` trait，包含`fn on_kline(&mut self, kline: &Kline) -> Signal`方法，作为所有策略的统一接口。 |
| STR-002 | 功能 | **MA交叉策略实现** | 应创建一个`MACrossover`结构体，实现`Strategy` trait。该结构体应包含两个`MA`实例。 |
| STR-003 | 功能 | **策略状态管理** | `MACrossover`策略必须正确管理其内部状态，以识别交叉事件（即需要记录前一个时间点的MA值）。 |
| STR-004 | 功能 | **策略构造** | `MACrossover`应提供`new(short_period: usize, long_period: usize)`构造函数，允许用户自定义MA周期。 |
| STR-005 | 功能 | **策略可测试性** | `MACrossover`策略应有独立的单元测试，输入一系列`Kline`数据，验证其在预期的交叉点能产生正确的`Buy`/`Sell`信号。 |

---

### **阶段三：历史回测 (Backtesting Engine)**

**目标：** 实现一个能评估`Strategy` trait实现的离线回测引擎。

| 需求ID | 需求类型 | 需求描述 | 验收标准 |
| :--- | :--- | :--- | :--- |
| **`aurora-backtester` (回测器)** |
| BCK-001 | 功能 | **回测引擎CLI** | 应提供`run`子命令，支持`--data-path` (CSV文件路径), `--strategy-name` (如`ma-crossover`), 以及策略相关参数（如`--short 10 --long 30`）。 |
| BCK-002 | 功能 | **数据加载** | 引擎必须能从指定的CSV文件路径加载数据，并将其解析为`Vec<Kline>`。 |
| BCK-003 | 功能 | **事件循环** | 引擎核心应为一个事件循环，按时间顺序遍历所有`Kline`数据，并将每个`Kline`传递给策略实例。 |
| BCK-004 | 功能 | **投资组合管理** | 应实现一个`Portfolio`模块，负责跟踪`cash`（现金）、`position`（持仓数量）、`total_equity`（总资产）等状态。 |
| BCK-005 | 功能 | **模拟执行** | 应实现一个`Executor`模块。当从策略收到`Buy`或`Sell`信号时，`Executor`根据当前的收盘价更新`Portfolio`的状态（暂不考虑交易成本）。 |
| BCK-006 | 非功能 | **执行逻辑** | 交易逻辑应避免“未来函数”，即在决定是否于`T`时刻交易时，只能使用`T`时刻及之前的信息。 |
| BCK-007 | 功能 | **业绩报告生成** | 回测结束后，必须在控制台打印一份详细报告：总回报率、年化回报率、最大回撤、夏普比率、胜率、总交易次数等。 |
| BCK-008 | 功能 | **模块化集成** | 回测器应能通过命令行参数动态选择并实例化在`aurora-strategy`中定义的策略。 |

---

### **阶段四：上线模拟 (Live Simulation)**

**目标：** 将框架扩展到能够处理实时数据流，并进行模拟交易。

| 需求ID | 需求类型 | 需求描述 | 验收标准 |
| :--- | :--- | :--- | :--- |
| **`aurora-live` (实时引擎)** |
| LIV-001 | 功能 | **实时引擎CLI** | 应提供`run`子命令，支持`--symbol`, `--strategy-name`及策略参数，与回测器保持相似的接口。 |
| LIV-002 | 功能 | **实时数据集成** | 引擎应复用`aurora-data`的WebSocket功能，以接收实时K线数据作为事件源。 |
| LIV-003 | 非功能 | **架构复用** | 实时引擎的内部结构应尽可能复用回测引擎的组件，例如`Portfolio`和`Strategy`的集成方式，仅替换数据源。 |
| LIV-004 | 功能 | **模拟交易执行器** | 应实现一个`PaperTrader`执行器。当收到交易信号时，它不执行真实交易，而是记录模拟交易日志，并更新内存中的`Portfolio`状态。 |
| LIV-005 | 功能 | **实时状态监控** | 引擎应能定期（如每分钟）通过日志输出当前模拟账户的总资产、持仓情况和盈亏。 |
| LIV-006 | 功能 | **外部通知** | （可选，高级功能）当产生模拟交易信号时，系统应能通过Webhook或其他方式（如Telegram Bot）向外部发送通知。 |
| LIV-007 | 非功能 | **健壮性** | 实时引擎必须能够7x24小时稳定运行。应能妥善处理网络中断、API错误等异常情况，并记录错误日志。 |